<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
 "http://www.w3.org/TR/html4/strict.dtd">

<?python
 from time import mktime
?>

<html xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../includes/common.html" />
  <xi:include href="../includes/site.html" />
<head>
  <title>Crash Reports in ${c.params.signature}</title>

  <script type="text/javascript" src="${h.url_for('/js/MochiKit/MochiKit.js')}"></script>
  <script type="text/javascript" src="${h.url_for('/js/PlotKit/PlotKit_Packed.js')}"></script>

  <style type="text/css">
   #buildid-div {
     height: 80px;
     width: 500px;
     margin-top: 0.5em;
     margin-bottom: 0.5em;
     margin-left: auto;
     margin-right: auto;
     display: none;
   }

   .machine-buildid {
     display: none;
   }
  </style>    

</head>

<body>

 <div id="content">
 <h1 class="first">Crash Reports in ${c.params.signature}</h1>

 <p>${str(c.params)}</p>


 <div id="buildid-div">
 <canvas id="buildid-graph" width="500" height="80"></canvas>
 </div>

 ${list_reports(c.reports)}
 
 <table id="buildid-table" class="list">
  <thead>
   <tr>
    <th>Build ID</th>
    <th class="machine-buildid">Machine BuildID</th>
    <th>Crash Count</th>
    <th>Frequency</th>
   </tr>
  </thead>
  <tbody>
   <?python row=1?>
   <tr py:for="build in c.builds" class="${h.get_row_class(row)}">
    <td class="human-buildid">${build.build_date.strftime('%Y%m%d%H')}</td>
    <td class="machine-buildid">${mktime(build.build_date.timetuple()) * 1000}</td>
    <td class="crash-count">${build.count}</td>
    <td class="crash-frequency">${build.frequency}</td>
    <?python row+=1 ?>
   </tr>
  </tbody>
 </table>

 </div>

<!-- end content -->

 <script type="text/javascript">
 function pad2(n)
 {
   return ("0" + n.toString()).slice(-2);
 };

 function formatDate(d)
 {
   return pad2(d.getMonth() + 1) + "-" + pad2(d.getDate());
 }

 var maxDate = ${mktime(c.max_build.timetuple()) * 1000};
 var minDate = ${mktime(c.min_build.timetuple()) * 1000};

 var interval = (maxDate - minDate) / 8;

 var xTicks = [];
 for (var i = 0; i &lt;= 8; ++i) {
   var e = minDate + interval * i;
   xTicks.push({label: formatDate(new Date(e)), v: e});
 }

 var layout = new Layout("line", {xOriginIsZero: false,
                                  xTicks: xTicks});
 layout.addDatasetFromTable("total", $("buildid-table"), 1, 3);
 layout.evaluate();

 if (layout.points.length > 1) {
   var display = false;
   for each (var point in layout.points) {
     if (point.yval > 0) {
       display = true;
       break;
     }
   }

   if (display) {
     var chart = new CanvasRenderer($('buildid-graph'), layout, {IECanvasHTC: '/js/PlotKit/iecanvas.htc'});
     chart.render();

     $('buildid-div').style.display = 'block';
   }
 }
 </script>

</body>
</html>
