{% extends "crashstats_base.html" %}
{% block site_js %}
  {{ super() }}
  <!--[if IE]><script type="text/javascript" src="/media/js/flot-0.7/excanvas.pack.js"></script><![endif]-->
  {{ js('crashstats_flot') }}
  {{ js('crashstats_daily') }}
  <script>
    var data = {"startDate": "{{ adubyday.start_date }}",
                "endDate": "{{ adubyday.end_date }}",
                "count": {{ adubyday.versions|count }},
                {% for version in adubyday.versions %}
                "item{{ loop.index }}": "{{ version.version }}",
                "ratio{{ loop.index }}": [
                    {% for stat in version.statistics|sort|groupby('date') if not stat[1]|sum('crashes') == 0 and not stat[1]|sum('users') == 0 %}
                    [{{ stat[0]|unixtime(millis=True) }},
                     {{ stat[1]|sum('crashes') / stat[1]|sum('users') * 100 }}],
                    {% endfor %}
                 ],
                {% endfor %}
                }
    console.log(data);
  </script>
{% endblock %}

{% block content %}<div id="mainbody">
    <div class="page-heading">
        <h2>{{ product }} Crash Data</h2>
         <ul class="options">
                <li><a href="/products/{{ product }}?duration=3" {% if duration == 3 %} class="selected" {% endif %}>3 days</a></li>
                <li><a href="/products/{{ product }}?duration=7" {% if duration == 7 %} class="selected" {% endif %}>7 days</a></li>
                <li><a href="/products/{{ product }}?duration=14" {% if duration == 14 %} class="selected" {% endif %}>14 days</a></li>
            </ul>
    </div>

    <div class="panel">
        <div class="title">
            <h2>Crashes per 100  Active Daily Users</h2>
        </div>
    
        <div class="body">
            <div id="adu-chart"></div>
        </div>
    </div>

    <div class="panel">
        <div class="title">
            <h2>Crash Reports</h2>
        </div>
    
        <div class="body">
            <div id="release_channels">
            {% for r in currentversions|groupby('product') %}
                {% if r[0] == product %}
                    {% for v in r[1] %}
                        {% if version == v.version %}
                <div class="release_channel  border_right">
                    <h4>{{ r[0] }} {{ v.version }}</h4>
                    <ul>
                      <li><a href="/topcrasher/byversion/{{ r[0] }}/{{ v.version }}/7">Top Crashers</a></li>
                      <li><a href="/products/{{ r[0] }}/{{ v.version }}/15.0a1/topchangers?duration=7">Top Changers</a></li>
                      <li><a href="/topcrasher/byversion/{{ r[0] }}/{{ v.version }}/7/plugin">Top Plugin Crashers</a></li>
                    </ul>
                </div>
                        {% elif not version and v.featured %}
                <div class="release_channel  border_right">
                    <h4>{{ r[0] }} {{ v.version }}</h4>
                    <ul>
                      <li><a href="/topcrasher/byversion/{{ r[0] }}/{{ v.version }}/7">Top Crashers</a></li>
                      <li><a href="/products/{{ r[0] }}/{{ v.version }}/15.0a1/topchangers?duration=7">Top Changers</a></li>
                      <li><a href="/topcrasher/byversion/{{ r[0] }}/{{ v.version }}/7/plugin">Top Plugin Crashers</a></li>
                    </ul>
                </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
            </div>
        <br class="clear" />
    </div>
    </div>
    <br class="clear" />
    </div>

{% endblock %}
